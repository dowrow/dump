<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Dump</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Don't like it? Dump it into the toilet!">
    <link rel="icon" href="images/favicon.ico">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#3f51b5">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="application-name" content="My App">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="My App">
    <link rel="apple-touch-icon" sizes="57x57" href="images/manifest/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="images/manifest/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/manifest/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="images/manifest/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/manifest/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="images/manifest/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="images/manifest/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="images/manifest/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="images/manifest/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192"  href="images/manifest/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="images/manifest/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="images/manifest/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="images/manifest/favicon-16x16.png">
    <meta name="msapplication-TileImage" content="images/manifest/icon-144x144.png">
    <meta name="msapplication-TileColor" content="#3f51b5">
    <meta name="msapplication-tap-highlight" content="no">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="@dowrow">
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="Dump">
    <meta property="og:image" content="images/manifest/icon-144x144.png" />
    <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin>
    <base href="/">
    <script>
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', function() {
          navigator.serviceWorker.register('service-worker.js', {
            scope: '/',
          });
        });
      }
    </script>
    <script src="./js/aframe.min.js"></script>
    <style>
      body {
        position: relative;
        margin: 0;
        min-height: 100vh;
        -webkit-font-smoothing: antialiased;
        width: 100%;
        display: block;
        padding: 24px;
      }

      .scene {
        position: relative;
        z-index: 1;
      }

      .url-input {
        position: absolute;
        top: 0;
        height: 70px;
        width: 100%;
        background-color: #fefee1;
        z-index: 2;
        text-align: center;
        font-size: 1.2em;
        font-family: system-ui, Helvetica, Arial, sans-serif;
        border: none;
        outline: none;
        color: #b0242f;
        font-weight: bold;
        margin-bottom: 50px;
      }

      .sharethis-inline-share-buttons {
        position: absolute;
        bottom: 0;
        z-index: 2;
        width: 100%;
      }
      
      .url-input::placeholder {
        color: #b0242fab;
      }

      .a-enter-vr-button {
        display: none;
      }

      @media(min-width: 500px) {
        .url-input {
          height: 50px;
          margin-left: -200px;
          margin-bottom: 77px;
          left: 50%;
          max-width: 400px;
          border-radius: 4px;
          bottom: 0;
          top: auto;
        }
        .sharethis-inline-share-buttons {
          margin-left: -200px;
          left: 50%;
          max-width: 400px;
          margin-bottom: 20px;
        }
      }
    </style>
  </head>
  <body>
    <a-scene class="scene" antialias="true"  physics="gravity: -0.1">
      <a-sky color="#ae2633"></a-sky>
      <a-entity gltf-model="url(/toilet/scene.gltf)" position="0 -0.01 0" rotation="0 -90 0"></a-entity>
      <a-plane static-body color="#ae2633" height="100" width="100" rotation="-90 0 0"></a-plane>
      <a-entity static-body position="0 0.9 1" rotation="-25 0 0" >
        <a-camera static-body camera look-controls></a-camera>
      </a-entity>
    </a-scene>
    <input class="url-input" type="text" placeholder="Paste Image URL Here"/>
    <div class="sharethis-inline-share-buttons"></div>
    <noscript>
      Please enable JavaScript to view this website.
    </noscript>
    <script>

      let images = [];
      let url = 'https://i.imgur.com/ikOOvQw.png?1';
      const scene = document.querySelector('a-scene');
      let generateInterval = setInterval(generatePicture, 2000);
      const removeInterval = setInterval(removeImages, 2000);

      document.querySelector('.url-input').addEventListener('input', (event) => {
        const inputData = event.target.value;
        document.location.href = '?image=' + encodeURIComponent(inputData);
      });

      document.addEventListener('DOMContentLoaded', () => {
        const imageUrl = getImageParameter();
        if (imageUrl) {
          document.querySelector('.url-input').value = decodeURIComponent(imageUrl);
          checkImage(imageUrl, () => {
            url = decodeURIComponent(imageUrl);
          }, () => {});
        }
      });

      function generatePicture() {
        if (!document.hidden){ 
          const image = document.createElement('a-image');
          image.setAttribute('src', url);
          image.setAttribute('dynamic-body', 'true');
          image.setAttribute('position', '0 1.3 0.2');
          image.setAttribute('height', '0.1');
          image.setAttribute('width', '0.1');
          image.setAttribute('mass', '1');
          scene.appendChild(image);
          images.push(image);
        }
      }

      function removeImages() {
        if (!document.hidden) {
          images.map((image) => {
            if (image.getAttribute('position').y < 0) {
              scene.removeChild(image);
            }
          });
          if (images.length > 0) {
            images = images.filter(image => image.getAttribute('position').y > 0);
          }
        }
      }

      function checkImage(url, good, bad) {
        const img = new Image();
        img.onload = good; 
        img.onerror = bad;
        img.src = url;
      }

      function getImageParameter() {
        const url = new URL(document.location.href);
        return url.searchParams.get("image");
      }

    </script>
    <script src='//platform-api.sharethis.com/js/sharethis.js#property=596a858e0f81140011019910&product=inline-share-buttons' async='async'></script>
  </body>
</html>
